name: FoodFast Frontend E2E

on:
  push:
    branches: [ "main" ]

jobs:
  test-frontend:
    runs-on: ubuntu-latest
    
    # QUAN TRỌNG: Thiết lập thư mục làm việc mặc định là folder chứa code React
    defaults:
      run:
        working-directory: ./foodfast-frontend

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        # Chỉ định đường dẫn file package-lock.json để cache hoạt động đúng
        cache-dependency-path: foodfast-frontend/package-lock.json

    - name: Install Dependencies
      # Lệnh này sẽ tự động chạy trong folder foodfast-frontend
      run: |
        npm install
        # Cài thêm các thư viện test nếu chưa có trong package.json
        npm install selenium-webdriver mocha wait-on --save-dev

    - name: Start App and Run Tests
      run: |
        # 1. Bật React App ở chế độ nền (&)
        npm start &
        
        # 2. Chờ cổng 3000 mở (Timeout 120s cho chắc chắn)
        npx wait-on http://localhost:3000 --timeout 120000
        
        # 3. Chạy lệnh test mà ta đã khai báo ở Bước 2
        npm run test:e2e
      env:
        CI: true